<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç ‚Äî Native Speech</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f9f6f3;
      padding: 20px;
      color: #333;
      display: flex;
      justify-content: center;
    }

    .cabinet-box {
      background: #fff;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      width: 100%;
    }

    h1 {
      font-size: 22px;
      margin-bottom: 10px;
    }
    h2 {
      font-size: 16px;
      margin-bottom: 20px;
    }

    .progress-section {
      margin-bottom: 20px;
    }
    .progress-title {
      font-weight: bold;
      margin-bottom: 8px;
    }
    .progress-bar {
      background: #ddd;
      border-radius: 20px;
      overflow: hidden;
      height: 18px;
      margin-bottom: 8px;
      width: 100%;
    }
    .progress-fill {
      background: #ffd966;
      height: 100%;
      width: 8%;
      transition: width 0.5s ease-in-out;
    }
    .progress-percent {
      font-size: 14px;
      color: #666;
    }

    .buttons {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .btn {
      padding: 10px 16px;
      background: #ffd966;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      flex-grow: 1;
      min-width: 120px;
    }
    .btn:hover {
      background: #f3cb50;
    }

    .lessons-container {
      margin-top: 20px;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    .lesson {
      border: 1px solid #eee3cc;
      background: #fffbe8;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 10px;
    }
    .lesson h3 {
      margin: 0 0 5px;
      font-size: 16px;
    }
    .lesson p {
      margin: 4px 0;
      font-size: 14px;
    }
    .grade {
      font-weight: bold;
      color: #5a8a2b;
    }
    .locked {
      opacity: 0.6;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 480px) {
      h1 { font-size: 20px; }
      h2 { font-size: 15px; }
      .btn { font-size: 14px; padding: 10px; }
      .lesson { padding: 10px; }
      .lesson h3 { font-size: 15px; }
      .lesson p { font-size: 13px; }
    }
  </style>
</head>
<body>

  <div class="cabinet-box">
    <h1 id="greeting">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
    <h2>–í–∞—à –∫—É—Ä—Å: –§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö</h2>

    <div class="progress-section">
      <div class="progress-title">–ü—Ä–æ–≥—Ä–µ—Å—Å:</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-percent" id="progressPercent">0% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
    </div>

    <div class="buttons">
      <button class="btn" id="toggleLessonsBtn">–ü–µ—Ä–µ–π—Ç–∏ –∫ —É—Ä–æ–∫–∞–º</button>
      <button class="btn" id="logoutBtn">–í—ã–π—Ç–∏</button>
    </div>

    <div class="lessons-container" id="lessonsContainer"></div>
  </div>
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  const supabaseUrl = 'https://hqnbqktancrptnkwlxuf.supabase.co';
  const supabaseKey = '—Ç–≤–æ–π_–∫–ª—é—á_anon';
  const supabase = createClient(supabaseUrl, supabaseKey);

  async function init() {
    const { data: { user }, error } = await supabase.auth.getUser();
    console.log('User:', user, 'Error:', error);

    if (!user) {
      // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω ‚Äî –ø–µ—Ä–µ–∫–∏–¥—ã–≤–∞–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
      window.location.href = 'login.html';
      return; // —á—Ç–æ–±—ã –¥–∞–ª—å—à–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥
    }

    // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã profiles
    const { data: profile, error: profileError } = await supabase
      .from('profiles')
      .select('name')
      .eq('id', user.id)
      .single();

    const name = profile?.name || user.email;
    document.getElementById("greeting").textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${name}`;

    // –ó–¥–µ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —É—Ä–æ–∫–∏, –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –ø—Ä–æ—á–µ–µ
    initLessons();
  }

  function initLessons() {
    const lessons = [
      { id: 1, title: "–£—Ä–æ–∫ 1: A‚ÄìF", description: "–ò–∑—É—á–∞–µ–º –ø–µ—Ä–≤—ã–µ –±—É–∫–≤—ã", always_open: true },
      { id: 2, title: "–£—Ä–æ–∫ 2: G‚ÄìL", description: "–°–ª–µ–¥—É—é—â–∏–µ 6 –±—É–∫–≤", always_open: false },
      { id: 3, title: "–£—Ä–æ–∫ 3: M‚ÄìR", description: "–°–ª–æ–∂–Ω—ã–µ –∑–≤—É–∫–∏", always_open: false },
      { id: 4, title: "–£—Ä–æ–∫ 4: S‚ÄìZ", description: "–§–∏–Ω–∞–ª—å–Ω—ã–µ –±—É–∫–≤—ã", always_open: false }
    ];

    const progress = [
      { lesson_id: 1, grade: "–û—Ç–ª–∏—á–Ω–æ" },
      { lesson_id: 2, grade: "–•–æ—Ä–æ—à–æ" },
      { lesson_id: 3, grade: null }
    ];

    const graded = progress.filter(p => p.grade).length;
    const percent = Math.round((graded / lessons.length) * 100);
    document.getElementById("progressFill").style.width = percent + "%";
    document.getElementById("progressPercent").textContent = percent + "% –∑–∞–≤–µ—Ä—à–µ–Ω–æ";

    function isLessonOpen(index) {
      if (lessons[index].always_open) return true;
      if (index === 0) return true;
      const prevLessonId = lessons[index - 1].id;
      const prevGrade = progress.find(p => p.lesson_id === prevLessonId)?.grade;
      return !!prevGrade;
    }

    function renderLessons() {
      const container = document.getElementById("lessonsContainer");
      container.innerHTML = "";
      lessons.forEach((lesson, index) => {
        const open = isLessonOpen(index);
        const grade = progress.find(p => p.lesson_id === lesson.id)?.grade;

        const div = document.createElement("div");
        div.className = "lesson" + (open ? "" : " locked");
        div.innerHTML = `
          <h3>${lesson.title}</h3>
          <p>${lesson.description}</p>
          ${grade ? `<p class="grade">–û—Ü–µ–Ω–∫–∞: ${grade}</p>` : ""}
          <button class="btn" ${open ? "" : "disabled"}>
            ${open ? "–ü–µ—Ä–µ–π—Ç–∏ –∫ —É—Ä–æ–∫—É" : "–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω üîí"}
          </button>
        `;
        container.appendChild(div);
      });
    }

    const btn = document.getElementById("toggleLessonsBtn");
    const lessonBox = document.getElementById("lessonsContainer");
    let visible = false;

    btn.addEventListener("click", () => {
      visible = !visible;
      if (visible) {
        renderLessons();
        lessonBox.style.display = "block";
        btn.textContent = "–°–∫—Ä—ã—Ç—å —É—Ä–æ–∫–∏";
      } else {
        lessonBox.style.display = "none";
        btn.textContent = "–ü–µ—Ä–µ–π—Ç–∏ –∫ —É—Ä–æ–∫–∞–º";
      }
    });

    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = 'login.html';
    });
  }

  // –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å—ë
  init();
</script>



</body>
</html>
