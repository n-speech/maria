<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–£—Ä–æ–∫</title>
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      padding: 1rem;
      margin: 0;
      background: #f9f9f9;
      color: #241c15;
      overflow-x: hidden;
      text-align: center;
    }
    #content {
      background: white;
      margin: 0 auto;
      max-width: 900px;
      border-radius: 0.5rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    h1 {
      font-size: 1.75rem;
      margin-bottom: 1rem;
    }
    iframe {
      width: 100%;
      height: 1000px;
      border: none;
      display: block;
    }
    @media (max-width: 650px) {
      iframe {
        height: 600px;
      }
    }
  </style>
</head>
<body>

<h1>–ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–∫–∞...</h1>
<div id="content"></div>

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js'

  // üîë –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ!
 const supabase = createClient(
  'https://hisourxrdfdjhgwbrpgs.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhpc291cnhyZGZkamhnd2JycGdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3MjQ5OTUsImV4cCI6MjA2NzMwMDk5NX0.mTMIj5cMPzB9EQmlo_P68nrT_cuWaQeczEReMdsQW7s'
)

  const contentEl = document.getElementById('content')
  const headingEl = document.querySelector('h1')

  // üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  const { data: sessionData } = await supabase.auth.getSession()
  const session = sessionData.session

  if (!session) {
    headingEl.textContent = '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω'
    contentEl.innerHTML = '<p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç.</p>'
    throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω')
  }

  // üß† –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ —É—Ä–æ–∫–∞ –≤ –±–∞–∫–µ—Ç–µ
  const lessonFolder = 'lesson1'
  const filePath = `${lessonFolder}/index.html`

  // üé´ –ü–æ–ª—É—á–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É
  const { data, error } = await supabase
    .storage
    .from('lessons')  // –Ω–∞–∑–≤–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞
    .createSignedUrl(filePath, 60)  // 60 —Å–µ–∫

  if (error || !data) {
    headingEl.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏'
    contentEl.innerHTML = '<p>–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —É—Ä–æ–∫—É.</p>'
    console.error(error)
    return
  }

  // üéâ –í—Å—Ç–∞–≤–ª—è–µ–º iframe —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Å—ã–ª–∫–æ–π
  headingEl.textContent = '–£—Ä–æ–∫'
  contentEl.innerHTML = `
    <iframe src="${data.signedUrl}" allowfullscreen></iframe>
  `
</script>

</body>
</html>


